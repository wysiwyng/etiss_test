<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ETISS 0.8.0: Bare-Metal Simulation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ETISS 0.8.0
   </div>
   <div id="projectbrief">ExtendableTranslatingInstructionSetSimulator(version0.8.0)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Bare-Metal Simulation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This folder contains a basic example project that uses ETISS.</p>
<p>The corresponding target software must firstly be build for the core. These can be found in SW subdirectory of the <code>examples</code> directory. When simulation running, the ETISS will translate compiled binary code into host executable code and simulate the behavior of target bare-metal core.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Getting Started</h1>
<p>Check the file <code>./ETISS.ini</code> to select desired architecture and plug-in to simulate. Target software path should be explicitly given for <b>sw_binary</b>. Also, other configuration options of ETISS are available in this file (e.g. logger severity level).</p>
<p>Check README in <code>../SW</code> to assure all prerequisites are fullfilled (e.g. setting up path to toolchain, getting required libraries, ...). You also find the detailed instructrions to compile SW in respective directories</p>
<p>After checking all prerequisites, execute the following commands to build the example software: </p><pre class="fragment">    $ cd ../SW/&lt;or1k&gt;|&lt;riscv&gt;/
    $ mkdir build &amp;&amp; cd build
    $ cmake ..
</pre><h2><a class="anchor" id="autotoc_md7"></a>
LINUX SYSTEM</h2>
<pre class="fragment">    $ make
</pre><p>After SW compilation, we can build and run the simulation with the following script: </p><pre class="fragment">    $ ./run_helper.sh path/to/target/binary
</pre><blockquote class="doxtable">
<p>NOTE: This script simply adds environment variables and starts the main executable </p>
</blockquote>
<p>with ETISS.ini as parameter.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
WINDOWS SYSTEM</h2>
<pre class="fragment">    $ cmake --build . --config $BUILD_TYPE
</pre><p>Set the PATH variable to include files in the build/installed/lib/ folder and then run the program by passing required architecture, jit and plugins. An example is shown here. Please use &ndash;help to display all configurations supported. </p><pre class="fragment">    $ $Env:Path="X:/path/to/lib;"+$Env:Path
    $ cd build/$BUILD_TYPE
</pre><blockquote class="doxtable">
<p>NOTE: $BUILD_TYPE is either Release or Debug depending on how it was compiled.) </p>
</blockquote>
<pre class="fragment">    $ main --vp.elf_file=X:/path/to/build/installed/examples/SW/riscv/build/riscv_example --arch.cpu=RISCV --jit.type=TCCJIT --etiss.loglevel=4 -pLogger
</pre><h1><a class="anchor" id="autotoc_md9"></a>
Debugging</h1>
<h2><a class="anchor" id="autotoc_md10"></a>
Debug ETISS</h2>
<pre class="fragment">    ./run_helper.sh ELFFILE gdb
</pre><h2><a class="anchor" id="autotoc_md11"></a>
Debug target software</h2>
<p>A <b>gdbserver</b> is integrated in ETISS, and it could be used to debug target core when it runs target SW. The gdbserver could be enabled by configure options in <code>./ETISS.ini</code> with this configuration: </p><pre class="fragment">    [Plugin gdbserver];
            plugin.gdbserver.port=&lt;port_number_you_defined&gt;
            minPcAlign=&lt;minimal_instruction_bits_alignment&gt;
</pre><p>The gdbserver surveilles undelying target SW, send/recieve commands to/from target core. The ETISS simulation will be suspended at the beginning of target SW, waiting for incoming command, if <b>gdbserver</b> is enabled.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Use gdbserver</h3>
<p>Short version: </p><pre class="fragment">    ./run_helper.sh ELFFILE tgdb
</pre><p>Requires KDE "Konsole", but add option "noattach" to attach to the gdbserver manually (see below).</p>
<p>Long version:</p>
<p>Run the ETISS (main) using aformentioned script, then invoke corresponding gdb in a new terminal. E.g. or1k-elf-gdb for or1k core. <b>Do not use system default gdb directly for target core.</b> The target SW executable should be given as an argument or given after entering gdb and using file command. The executable is used to load symbol table. For example: </p><pre class="fragment">    $ &lt;target_toolchain&gt;-elf-gdb &lt;SW_directory&gt;/&lt;target_SW&gt;.elf
</pre><p>alternative: </p><pre class="fragment">    $ &lt;target_toolchain&gt;-elf-gdb
    $ (gdb) file &lt;SW_directory&gt;/&lt;target_SW&gt;.elf
</pre><p>Then you should connect gdb to gdbserver inside ETISS </p><pre class="fragment">    $ (gdb) target remote :&lt;port_number_you_defined&gt;  //local computer
</pre><p>or: </p><pre class="fragment">    $ (gdb) target remote &lt;host_ip&gt;:&lt;port_number_you_defined&gt;  // connect through internet to remote computer
</pre><p>As connection between gdb and gdbserver is established, standard gdb command could be used to debug target SW.</p>
<blockquote class="doxtable">
<p>RSP protocal commands (internal gdb commands) such as 'g', 'G' </p>
</blockquote>
<p>for read/write all registers, are invisible for gdb user. These commands cannot be recognized by gdb.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
Using an IDE for debugging</h3>
<p>As long as the IDE supports remote debugging with GDB, it will be able to connect to the GDBServer of ETISS.</p>
<h4><a class="anchor" id="autotoc_md14"></a>
Eclipse</h4>
<p>For example use the following steps to debug with Eclipse (<a href="https://stackoverflow.com/a/45608937">https://stackoverflow.com/a/45608937</a>):</p>
<p>Setup:</p>
<ul>
<li>Get "Eclipse IDE for C/C++ Developers"</li>
<li>Open Eclipse</li>
<li>Menu: Run -&gt; Debug Configurations...</li>
<li>Select: C/C++ Remote Application</li>
<li>Press "New Configuration" button on top</li>
<li>At the bottom click on "Select other..."</li>
<li>Check: Use configuration specific settings</li>
<li>Select: GDB (DSF) Manual Remote Debugging Launcher</li>
<li>Main tab: Enter C/C++ Application path</li>
<li>Debugger tab -&gt; Main sub-tab: Enter toolchain GDB path into "GDB debugger"</li>
<li>Debugger tab -&gt; Connection sub-tab: TCP, localhost, 2222</li>
<li>Click Apply, Close</li>
</ul>
<p>Usage:</p>
<ul>
<li>Run ETISS with GDBServer enabled</li>
<li>Menu: Run -&gt; Debug</li>
</ul>
<h4><a class="anchor" id="autotoc_md15"></a>
Visual Studio Code</h4>
<p>Create a new debugging configuration for your project by going to the debug side-view on the left. Click on the drop-down, select "Add Config (your project name)", select environment "C++ (GDB/LLDB)". Adjust the file that opens like the following: </p><pre class="fragment">    {
            // Use IntelliSense to learn about possible attributes.
            // Hover to view descriptions of existing attributes.
            // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
            "version": "0.2.0",
            "configurations": [
                    {
                            "name": "ETISS Debug",
                            "type": "cppdbg",
                            "request": "launch",
                            "program": "${workspaceFolder}/target_sw/bin/target_binary.elf",
                            "miDebuggerServerAddress": "localhost:2222",
                            "args": [],
                            "stopAtEntry": false,
                            "cwd": "${workspaceFolder}",
                            "environment": [],
                            "externalConsole": false,
                            "MIMode": "gdb",
                            "setupCommands": [
                                    {
                                            "description": "Enable pretty-printing for gdb",
                                            "text": "-enable-pretty-printing",
                                            "ignoreFailures": true
                                    }
                            ],
                            "miDebuggerPath": "/usr/local/research/projects/SystemDesign/tools/riscv/current/bin/riscv32-unknown-elf-gdb"
                    }
            ]
    }
</pre><h1><a class="anchor" id="autotoc_md16"></a>
Snapshot</h1>
<p>The output during execution should look similar to this:</p>
<h2><a class="anchor" id="autotoc_md17"></a>
GDB output in terminal</h2>
<p>When utilizing <b>gdbserver</b> to debug target software.</p>
<p><img src="gdbSnapshot.png" alt="" title="GDB output in terminal" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md18"></a>
ETISS output in terminal</h2>
<p><img src="etissSnapshot.png" alt="" title="ETISS output in terminal" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 19 2022 12:53:22 for ETISS 0.8.0 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
