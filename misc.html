<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ETISS 0.8.0: Additional Information</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ETISS 0.8.0
   </div>
   <div id="projectbrief">ExtendableTranslatingInstructionSetSimulator(version0.8.0)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Additional Information </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="misc_striplibrary"></a>
Removing symbols from a shared library</h1>
<p>ETISS can load shared libraries at runtime to add <a class="el" href="classetiss_1_1CPUArch.html" title="the interface to translate instructions of and processor architecture">etiss::CPUArch</a>,<a class="el" href="classetiss_1_1JIT.html" title="compiler interface for just in time compilation of generated C code">etiss::JIT</a> and <a class="el" href="classetiss_1_1Plugin.html" title="base plugin class that provides access to different plugin functions if present">etiss::Plugin</a> implementations. Since these libraries may contain symbols that are used in generated code those libraries are loaded with RTLD_GLOBAL into the application. To prevent problems with symbols that are defined in multiple libraries it is strongly recommended to strip all symbols that are not needed for ETISS's library loading mechanism or are not used in generated code. Additionally any non stripped symbol should have a prefix related to the library name (e.g. LIBNAME_customPrint() instead of customPrint()).</p>
<p>To strip unneeded symbols add "-Wl,--version-script=YOURSTRIPCONFIGURATION.cfg" (without quotes) to the build command of a shared library. E.g.:</p>
<div class="fragment"><div class="line">libGCCJIT.so : <a class="code" href="classGCCJIT.html">GCCJIT</a>.o GCCJITLIB.cpp</div>
<div class="line">        $(CC) -std=<a class="code" href="____clang__hip__libdevice__declares_8h.html#ad55181c98da0de5b29a5afc3060fc6d0">c</a>++0<a class="code" href="namespaceetiss_1_1fault.html#ae605b1063cbd269d9010913d1f56ba21">x</a> -shared -g -fPIC -MMD -<a class="code" href="namespaceetiss_1_1instr.html#a4b8d8e3ab5c613e688e168c06485cf65">I</a>$(BaseFolder)/include -<a class="code" href="namespaceetiss_1_1instr.html#a4b8d8e3ab5c613e688e168c06485cf65">I</a>$(BaseFolder)/include_c GCCJITLIB.cpp -o libGCCJIT.so <a class="code" href="classGCCJIT.html">GCCJIT</a>.o -Wl,--version-script=GCCJITLIBAPI.cfg</div>
</div><!-- fragment --><p> (excerpt from JITImpl/GCC/Makefile)</p>
<p>The file YOURSTRIPCONFIGURATION.cfg should look similar to this:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">global: </div>
<div class="line">        <a class="code" href="GCCJITLIB_8cpp.html#a138e2bf323b9ea6b2f62e7df27cbfc3a">GCCJIT_countJIT</a>;</div>
<div class="line">        <a class="code" href="GCCJITLIB_8cpp.html#ac21b47925989b26793574933779f677d">GCCJIT_nameJIT</a>;</div>
<div class="line">        <a class="code" href="GCCJITLIB_8cpp.html#a73820cf784ae48b666a3c1d0f632cf98">GCCJIT_createJIT</a>;</div>
<div class="line">        <a class="code" href="GCCJITLIB_8cpp.html#a00ced54aee1e8fcaef369c31a685e44c">GCCJIT_deleteJIT</a>;</div>
<div class="line">        GCCJIT_etissversion;</div>
<div class="line">local: *;</div>
<div class="line">};</div>
</div><!-- fragment --><p> (JITImpl/GCC/GCCJITLIBAPI.cfg)</p>
<p>Symbols that are defined as global in above example can be found once the library was loaded. Local symbols can only be used within the library. "local: *;" defines all symbols as local if they are not explicitly defined as global.</p>
<h1><a class="anchor" id="misc_codegenoverview"></a>
Storage Class Structure and Code Location Overview</h1>
<p>The following image shows the structure and location of the code (and additional information) that is stored in different classes. Dashed lines indicate that sub elements are not shown in this instance but there is always one type instance with all sub elements. The example code that is stored in the shown classes has a gray background. Underlined strings mark classes related to code storage except in the case of <a class="el" href="classetiss_1_1CodePart.html#a32a511b8940a4bb14c0edf338e460282" title="defines position,optionality and the ability to return a code for a CodePart.">etiss::CodePart::TYPE</a> and sub entries which are an enumeration that defines CodePart positions. If the codepart type contains the keyword optional then the codepart may be discarded if the getAffectedRegister() set will be overwritten before it is used. If the codepart type contains the keyword returning then the code may have a return statement (must return etiss_int32). In this case the conjunction of the getAffectedRegister() set together with a set of overwritten registers of the following codeparts is used to remove previous optional CodeParts if possible.</p>
<p>Any CodePart should define a proper affected and required RegisterSet to allow full optimization. If a group of registers is only used by non optional code parts (optional code parts may still read them) then they may be left out of register sets.</p>
<div class="image">
<img src="Code Generation Overview.png" alt=""/>
</div>
<h1><a class="anchor" id="misc_integratelibrary"></a>
Integrate a Library into an executable using ETISS</h1>
<p>The guides <a class="el" href="howto_cpuarch.html">How to implement a cpu architecture for ETISS</a> <a class="el" href="howto_jit.html">How to implement a just in time compiler for ETISS</a> <a class="el" href="howto_plugin.html">How to implement a plugin for ETISS</a> describe a way to create a dynamic library for ETISS. Alternatively it is possible to have such a library inside an application that uses ETISS. This can be achieved by either linking a static library or directly using object files. If <a class="el" href="group__ETISS__Frontend.html#ga0f7e980b54452e20ed605353acc02e3b" title="Load a library.">etiss::loadLibrary()</a> should be used to open that library the same functions as needed for a dynamic library (see <a class="el" href="doc_libraryinterface.html">Interface for libraries</a>) are needed and that the main executable must make these symbols available to the dynamic linker (appending the -rdynamic flag to the linking step is the most basic way to do that but may come at a performance penalty for large executables)</p>
<p>Integrated symbols will be looked up with the library name as a prefix. Therefore that name must match the library name even if it has been integrated into the executable. Althought possible it is not recommended to define those functions without a prefix. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespaceetiss_1_1fault_html_ae605b1063cbd269d9010913d1f56ba21"><div class="ttname"><a href="namespaceetiss_1_1fault.html#ae605b1063cbd269d9010913d1f56ba21">etiss::fault::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="Injector_8cpp_source.html#l00060">Injector.cpp:60</a></div></div>
<div class="ttc" id="aclassGCCJIT_html"><div class="ttname"><a href="classGCCJIT.html">GCCJIT</a></div><div class="ttdoc">provides compilation via gcc and load the compilation result with dlopen/dlsym functions</div><div class="ttdef"><b>Definition:</b> <a href="GCCJIT_8h_source.html#l00049">GCCJIT.h:49</a></div></div>
<div class="ttc" id="aGCCJITLIB_8cpp_html_ac21b47925989b26793574933779f677d"><div class="ttname"><a href="GCCJITLIB_8cpp.html#ac21b47925989b26793574933779f677d">GCCJIT_nameJIT</a></div><div class="ttdeci">const char * GCCJIT_nameJIT(unsigned i)</div><div class="ttdef"><b>Definition:</b> <a href="GCCJITLIB_8cpp_source.html#l00060">GCCJITLIB.cpp:60</a></div></div>
<div class="ttc" id="aGCCJITLIB_8cpp_html_a138e2bf323b9ea6b2f62e7df27cbfc3a"><div class="ttname"><a href="GCCJITLIB_8cpp.html#a138e2bf323b9ea6b2f62e7df27cbfc3a">GCCJIT_countJIT</a></div><div class="ttdeci">ETISS_LIBRARYIF_VERSION_FUNC_IMPL unsigned GCCJIT_countJIT()</div><div class="ttdef"><b>Definition:</b> <a href="GCCJITLIB_8cpp_source.html#l00058">GCCJITLIB.cpp:58</a></div></div>
<div class="ttc" id="anamespaceetiss_1_1instr_html_a4b8d8e3ab5c613e688e168c06485cf65"><div class="ttname"><a href="namespaceetiss_1_1instr.html#a4b8d8e3ab5c613e688e168c06485cf65">etiss::instr::I</a></div><div class="ttdeci">uint32_t I</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00079">Instruction.h:79</a></div></div>
<div class="ttc" id="a____clang__hip__libdevice__declares_8h_html_ad55181c98da0de5b29a5afc3060fc6d0"><div class="ttname"><a href="____clang__hip__libdevice__declares_8h.html#ad55181c98da0de5b29a5afc3060fc6d0">c</a></div><div class="ttdeci">__device__ __2f16 float c</div><div class="ttdef"><b>Definition:</b> <a href="____clang__hip__libdevice__declares_8h_source.html#l00298">__clang_hip_libdevice_declares.h:298</a></div></div>
<div class="ttc" id="aGCCJITLIB_8cpp_html_a73820cf784ae48b666a3c1d0f632cf98"><div class="ttname"><a href="GCCJITLIB_8cpp.html#a73820cf784ae48b666a3c1d0f632cf98">GCCJIT_createJIT</a></div><div class="ttdeci">etiss::JIT * GCCJIT_createJIT(unsigned i, std::map&lt; std::string, std::string &gt; options)</div><div class="ttdef"><b>Definition:</b> <a href="GCCJITLIB_8cpp_source.html#l00062">GCCJITLIB.cpp:62</a></div></div>
<div class="ttc" id="aGCCJITLIB_8cpp_html_a00ced54aee1e8fcaef369c31a685e44c"><div class="ttname"><a href="GCCJITLIB_8cpp.html#a00ced54aee1e8fcaef369c31a685e44c">GCCJIT_deleteJIT</a></div><div class="ttdeci">void GCCJIT_deleteJIT(etiss::JIT *jit)</div><div class="ttdef"><b>Definition:</b> <a href="GCCJITLIB_8cpp_source.html#l00069">GCCJITLIB.cpp:69</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 19 2022 12:53:22 for ETISS 0.8.0 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
